#!/bin/bash
contest_number="$1"

# まず現在のブランチをチェック
current_branch=$(git branch --show-current)

if ! git branch "$contest_number"; then
    echo "ブランチの作成に失敗しました"
    exit 1
fi

if ! git switch "$contest_number"; then
    echo "ブランチの切り替えに失敗しました"
    exit 1
fi

if [ "$current_branch" == "main" ]; then
    echo "現在のブランチが main です: $current_branch"
    exit 1
fi

if ! acc new "$contest_number"; then
    echo "acc new の実行に失敗しました"
    git switch main
    exit 1
fi

if [ -d "$contest_number" ]; then
    cd "$contest_number" || exit 1
else
    echo "ディレクトリ $contest_number が存在しません"
    exit 1
fi